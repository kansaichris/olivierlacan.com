---
layout: post
title: "Making API calls efficient with caching"
date: 2014-07-28 22:11
location: "New York City, New York"
categories: development
draft: true
---

I was recently working on building a new API for
codeschool.com. One of the requirements of the API is that it should be
possible for clients querying it to know wether the responses they have
received earlier are stale or not when they make subsequent queries.
There are three simple ways to achieve this:

1. with its response your API endpoint can send a `Last-Modified` header
   — a key/value pair where the actual date when the content being
   queried for was last modified is the value and `Last-Modified` is the
   name of the key. In turn, the client can store that date and send it
   with a request to the API using the `If-Modified-Since` header.
2. with its response your API endpoint can send an `ETag` (for Entity
   Tag) header — another key/value pair where the value is a random
   assortment of letters and numbers (or "hash") generated based on the
   content (the entity) the API is sending back and which changes every
   time the content changes. In turn, the client can store that ETag and
   send it along with a request to the API using the `If-None-Match`
   header.

If the `If-Modified-Since` date is less recent than the `Last-Modified`
date the server should send the expected content within the body of the
response. If the `If-Modified-Since` date matches the `Last-Modified`
date, the server should not send the expected content within the body of
the response. Instead it should send a status code of 304 which stands
for "Not Modified". This allows the client to avoid downloading the body
of the response unnecessarily.

The same goes for the `ETag` and `If-None-Match` headers, despite their
poor naming match. If the client stores the `ETag` from the last
full[^1] response it received, then sends it inside the `If-None-Match`
header in a request, and the ETag generated by the server matches this
value, then the server should also send back a 304 status code and no
body.

| Server-side    | Client-side        | Example                       |
|----------------|--------------------|-------------------------------|
| ETag           | If-None-Match      | "686897696a7c876b7e"          |
| Last-Modified  | If-Modified-Since  | Wed, 15 Nov 1995 04:58:08 GMT |

These two techniques can be used in combination since the `Last-
Modified` date may be meaningful to end-users ("updated 3 days ago") and
the `ETag` allows you to avoid doing date comparisons on the client.
ETags and Last-Modified headers are understood by (good) browsers to
avoid loading content they already have downloaded and stored in their
cache previously, which speeds up page and asset loading dramatically.

[^1]: By full response I mean a response that includes a body as opposed to a 304 response without a body (or with an empty body).
